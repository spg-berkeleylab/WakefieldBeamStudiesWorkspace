<!-- 
     beamcal parameters for ILD 
-->

<detector name="BeamCal" type="BeamCal_o1_v01" vis="SeeThrough" id="ILDDetID_BCAL"
	  readout="BeamCalCollection" insideTrackingVolume="false" buildType="BUILD_ENVELOPE" >

  <type_flags type=" DetType_CALORIMETER + DetType_ENDCAP + DetType_ELECTROMAGNETIC + DetType_FORWARD + DetType_AUXILIARY " />

   <envelope vis="ILD_FCALVis">
      <shape type="BooleanShape" operation="Intersection" material="Air">
	<shape type="Box" dx="BeamCal_outer_radius*2.0" dy="BeamCal_outer_radius*2.0" dz="BeamCal_max_z*2.0"/>

	<shape type="BooleanShape" operation="Union" material="Air">

	  <!-- -z -->
	  <shape type="BooleanShape" operation="Subtraction" material="Air">

	    <shape type="BooleanShape" operation="Subtraction" material="Air">
	      <!-- BeamCal -->
	      <shape type="Tube" rmin="BeamCal_inner_radius - env_safety" 
		     rmax="BeamCal_outer_radius + env_safety" 
		     dz="BeamCal_max_z/COS_halfCrossingAngle + env_safety"/>
	      <!-- Incoming beampipe cutout -->
	      <shape type="Tube" rmin="0.0" rmax="BCal_TubeIncomingRadius + BCal_TubeIncomingClearance - env_safety"
		     dz="BeamCal_max_z*2.0 +env_safety"/>
	      <rotation x="0" y="ILC_Main_Crossing_Angle" z="0"/>
	      <position x="0" y="0" z="0"/>
	    </shape>

	    <!-- Volume to subtract from center to z_min -->
	    <shape type="BooleanShape" operation="Union" material="Air">
	      <!-- Tungsten radius -->
	      <shape type="Tube" rmin="BCal_rGraphite + 1*env_safety" rmax="BeamCal_outer_radius + 1.5*env_safety"
		     dz="BeamCal_min_z/COS_halfCrossingAngle+BeamCal_thickness + BCal_dGraphite/COS_halfCrossingAngle - env_safety"/>
	      <!-- Graphite radius -->
	      <shape type="Tube" rmin="0" rmax="BCal_rGraphite  + 1.5*env_safety"
		     dz="BeamCal_min_z/COS_halfCrossingAngle+BeamCal_thickness - env_safety"/>
	      <position x="0" y="0" z="0"/>
	    </shape>

	    <position x="0" y="0" z="BeamCal_thickness"/>
	  </shape>

	  <!-- +z -->
	  <shape type="BooleanShape" operation="Subtraction" material="Air">

	    <shape type="BooleanShape" operation="Subtraction" material="Air">
	      <!-- BeamCal -->
	      <shape type="Tube" rmin="BeamCal_inner_radius - env_safety" 
		     rmax="BeamCal_outer_radius + env_safety" 
		     dz="BeamCal_max_z/COS_halfCrossingAngle + env_safety"/>
	      <!-- Incoming beampipe cutout -->
	      <shape type="Tube" rmin="0.0" rmax="BCal_TubeIncomingRadius + BCal_TubeIncomingClearance - env_safety"
		     dz="BeamCal_max_z*2.0 + env_safety"/>
	      <rotation x="0" y="-ILC_Main_Crossing_Angle" z="0"/>
	      <position x="0" y="0" z="0"/>
	    </shape>

	    <!-- Volume to subtract from center to z_min -->
	    <shape type="BooleanShape" operation="Union" material="Air">
	      <!-- Tungsten radius -->
	      <shape type="Tube" rmin="BCal_rGraphite + 1*env_safety" rmax="BeamCal_outer_radius + 1.5*env_safety"
		     dz="BeamCal_min_z/COS_halfCrossingAngle+BeamCal_thickness + BCal_dGraphite/COS_halfCrossingAngle - env_safety"/>
	      <!-- Graphite radius -->
	      <shape type="Tube" rmin="0" rmax="BCal_rGraphite  + 1.5*env_safety"
		     dz="BeamCal_min_z/COS_halfCrossingAngle+BeamCal_thickness - env_safety"/>
	      <position x="0" y="0" z="0"/>
	    </shape>
	    <position x="0" y="0" z="-BeamCal_thickness"/>
	  </shape>

	  <!-- Angel between -z and +z -->
	  <rotation x="0" y="ILC_Main_Crossing_Angle" z="0"/>
	  <position x="0" y="0" z="0"/>
	</shape>

	<!-- Use big box to define the global coordination -->
	<rotation x="0" y="-ILC_Main_Crossing_Angle*0.5" z="0"/>
	<position x="0" y="0" z="0"/>
      </shape>
    </envelope>  

  <parameter crossingangle="ILC_Main_Crossing_Angle"
	     cutoutspanningangle="BCal_cutoutSpanning"
	     incomingbeampiperadius="BCal_TubeIncomingRadius + BCal_TubeIncomingClearance"
	     />
  
  <dimensions inner_r = "BCal_rInner"
	      inner_z = "BeamCal_min_z"
	      outer_r = "BCal_rOuter" />
  
  <!-- <layer repeat="1" vis="SeeThrough"> -->
  <!--   <slice material = "C"         thickness = "BCal_dGraphite" vis="LayerVis1"      layerType="holeForIncomingBeampipe"/> -->
  <!-- </layer> -->
  
  <layer repeat="1" vis="SeeThrough">
    <slice material = "C"       thickness = "BCal_dGraphite" vis="LayerVis1" outer_radius = "BCal_rGraphite"  layerType="holeForIncomingBeampipe"/>
    <slice material = "TungstenDens24" thickness = "BCal_dAbsorber"        vis="BCLayerVis1" layerType="holeForIncomingBeampipe" />
    <slice material = "Silicon" thickness = "0.3004*mm" sensitive = "yes"  vis="BCLayerVis2"/>
    <slice material = "Copper"  thickness = "0.0004*mm"                    vis="BCLayerVis3"/>
    <slice material = "Kapton"  thickness = "0.15*mm"                      vis="BCLayerVis4"/>
    <slice material = "Air"     thickness = "0.05*mm" />
  </layer>

  <layer repeat="BCal_nLayers-1" vis="SeeThrough">
    <slice material = "TungstenDens24" thickness = "BCal_dAbsorber"        vis="BCLayerVis1" layerType="holeForIncomingBeampipe" />
    <slice material = "Silicon" thickness = "0.3004*mm" sensitive = "yes"  vis="BCLayerVis2"/>
    <slice material = "Copper"  thickness = "0.0004*mm"                    vis="BCLayerVis3"/>
    <slice material = "Kapton"  thickness = "0.15*mm"                      vis="BCLayerVis4"/>
    <slice material = "Air"     thickness = "0.05*mm" />
  </layer>

</detector>
